<project name="kotlin">

    <!-- download kotlin compiler and add kotlinc task -->

    <property name="kotlin.compiler.version" value="1.4.32"/>
    <property name="kotlin.home" value="${dir.download}/kotlin/kotlin-${kotlin.compiler.version}"/>

    <property name="kotlin.compiler.filename" value="kotlin-compiler-${kotlin.compiler.version}.zip"/>
    <property name="kotlin.compiler.filepath" value="${kotlin.home}/${kotlin.compiler.filename}"/>

    <property name="kotlin.task.filepath" value="${kotlin.home}/kotlinc/lib/kotlin-ant.jar"/>

    <target name="kotlin.define" depends="kotlin.retrieve">
        <echo>Loading kotlinc task at ${kotlin.task.filepath}</echo>
        <typedef resource="org/jetbrains/kotlin/ant/antlib.xml" classpath="${kotlin.task.filepath}"/>
    </target>

    <target name="kotlin.retrieve" depends="kotlin.available.check, kotlin.zipfile.unzip"/>

    <target name="kotlin.available.check">
        <available file="${kotlin.task.filepath}" property="kotlin.downloaded.already"/>
    </target>

    <target name="kotlin.zipfile.unzip" depends="kotlin.download" unless="kotlin.downloaded.already">
        <unzip src="${kotlin.compiler.filepath}" dest="${kotlin.home}"/>
    </target>

    <target name="kotlin.download" depends="kotlin.download.check, kotlin.download.http"/>

    <target name="kotlin.download.check">
        <available file="${kotlin.compiler.filepath}" property="kotlin.downloaded.already"/>
    </target>

    <target name="kotlin.download.http" unless="kotlin.downloaded.already">
        <mkdir dir="${kotlin.home}"/>
        <get src="https://github.com/JetBrains/kotlin/releases/download/v${kotlin.compiler.version}/${kotlin.compiler.filename}"
             dest="${kotlin.compiler.filepath}" />
    </target>

</project>