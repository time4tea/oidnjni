<project name="oidnlib">

    <property name="oidn.download.location" location="${dir.download}/oidn"/>

    <property name="oidn.linux.name" value="oidn-${oidn.lib.version}.x86_64.linux"/>
    <property name="oidn.macos.name" value="oidn-${oidn.lib.version}.x86_64.macos"/>

    <property name="oidnlib.linux.tar.file" value="${oidn.linux.name}.tar.gz"/>
    <property name="oidnlib.macos.tar.file" value="${oidn.macos.name}.tar.gz"/>

    <property name="oidnlib.linux.tar.path" value="${oidn.download.location}/${oidnlib.linux.tar.file}"/>
    <property name="oidnlib.macos.tar.path" value="${oidn.download.location}/${oidnlib.macos.tar.file}"/>

    <property name="oidnlib.linux.base" location="${oidn.download.location}/${oidn.linux.name}"/>
    <property name="oidnlib.macos.base" location="${oidn.download.location}/${oidn.macos.name}"/>

    <target name="oidn.download.prepare">
        <mkdir dir="${oidn.download.location}"/>
    </target>

    <target name="oidnlib.download" depends="oidnlib.download.linux, oidnlib.download.macos"/>

    <target name="oidnlib.download.linux" depends="oidnlib.download.linux.check, oidnlib.download.linux.http"/>

    <target name="oidnlib.download.linux.check">
        <available file="${oidnlib.linux.tar.path}" property="oidnlib.linux.downloaded.already"/>
    </target>

    <target name="oidnlib.download.linux.http"
            depends="oidn.download.prepare"
            unless="oidnlib.linux.downloaded.already">
        <get src="https://github.com/OpenImageDenoise/oidn/releases/download/v${oidn.lib.version}/${oidnlib.linux.tar.file}"
             dest="${oidnlib.linux.tar.path}"/>
    </target>

    <target name="oidnlib.unzip.linux" depends="oidnlib.unzip.linux.check, oidnlib.unzip.linux.exec"/>

    <target name="oidnlib.unzip.linux.check">
        <available file="${oidnlib.linux.base}" property="oidn.linux.uptodate"/>
    </target>

    <target name="oidnlib.unzip.linux.exec" depends="oidnlib.download.linux" unless="oidn.linux.uptodate">
        <untar compression="gzip" src="${oidnlib.linux.tar.path}" dest="${oidn.download.location}"/>
    </target>

    <target name="oidnlib.download.macos" depends="oidnlib.download.macos.check, oidnlib.download.macos.http"/>

    <target name="oidnlib.download.macos.check">
        <available file="${oidnlib.macos.tar.path}" property="oidnlib.macos.downloaded.already"/>
    </target>

    <target name="oidnlib.download.macos.http"
            depends="oidn.download.prepare"
            unless="oidnlib.macos.downloaded.already">
        <get src="https://github.com/OpenImageDenoise/oidn/releases/download/v${oidn.lib.version}/${oidnlib.macos.tar.file}"
             dest="${oidnlib.macos.tar.path}"/>
    </target>

    <target name="oidnlib.unzip.macos" depends="oidnlib.unzip.macos.check, oidnlib.unzip.macos.exec"/>

    <target name="oidnlib.unzip.macos.check">
        <available file="${oidnlib.macos.base}" property="oidn.macos.uptodate"/>
    </target>

    <target name="oidnlib.unzip.macos.exec" depends="oidnlib.download.macos" unless="oidn.macos.uptodate">
        <untar compression="gzip" src="${oidnlib.macos.tar.path}" dest="${oidn.download.location}"/>
    </target>
    
</project>